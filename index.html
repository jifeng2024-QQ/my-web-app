<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>数字记忆挑战</title>
<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 20px;
  margin: 0;
  background-color: #f7f7f7;
}

#timers {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
  gap: 20px;
}

#numberDisplay, #inputArea {
  margin: 20px 0;
}

#numberDisplay div, #inputArea div {
  display: flex;
  justify-content: center;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

button {
  margin: 10px auto;
  padding: 10px 20px;
  font-size: 18px;
  text-align: center;
  border: 1px solid #ddd;
  border-radius: 4px;
  display: block;
}

#inputArea .input-container {
  position: relative;
  width: 30px;
  height: 30px;
  display: inline-block;
  margin: 2px;
  border: 1px solid #ddd;
  border-radius: 4px;
  text-align: center;
}

#inputArea .input-container input {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center; /* 垂直居中 */
  justify-content: center; /* 水平居中 */
  font-size: 18px;
  outline: none;
  border: none;
  background: transparent;
  color: #000; /* 设置文字颜色 */
  text-align: center; /* 居中文本 */
}

#numberDisplay {
  display: flex;
  flex-direction: column;
  align-items: center;
}

#numberDisplay .row {
  display: flex;
  justify-content: space-between;
  width: 100%;
  max-width: 80vw; /* 限制最大宽度 */
}

#numberDisplay .row span {
  font-size: 25px; /* 默认字体大小改为30像素 */
  display: inline-block;
}

#correctNumbers {
  margin-top: 20px;
  font-size: 18px;
}

#correctNumbers span {
  margin: 0 0.5px;
}

.error {
  color: red;
}

/* 调整 h1 字体大小 */
h1 {
  font-size: 2.2em; /* 你可以根据需要调整这个值 */
  margin-bottom: 0.2em; /* 控制与 h2 的间距 */
}

/* 修改 h2 样式 */
h2 {
  font-size: 1.8em; /* 主标题字体大小 */
  margin: 0 0 0.5em; /* 调整与副标题的行间距 */
}

h2 small {
  display: block;
  font-size: 0.8em; /* 调整副标题字体大小 */
  margin-top: 0.05em; /* 更小的行间距 */
  color: #888; /* 将副标题颜色调整为灰色 */
}

/* 为“选择行数”后的输入框定义样式 */
.rows-input {
  width: 50px; /* 调整宽度 */
  height: 24px; /* 调整高度 */
  font-size: 14px; /* 调整字体大小 */
  text-align: center; /* 文本居中 */
  padding: 0; /* 移除内边距 */
  border: 1px solid #ccc; /* 边框样式 */
  border-radius: 4px; /* 圆角 */
}

/* 响应式样式 */
@media (max-width: 600px) {
  button {
    font-size: 16px;
    padding: 8px 16px;
  }

  #numberDisplay span {
    font-size: 24px; /* 在小屏幕设备上减小字体大小 */
  }
}

/* 分割“回忆时间”到下一行 */
#result {
  white-space: pre-line;
}
</style>
</head>
<body>
<h1>数字记忆挑战</h1>
<h2>
  世界记忆大师 邱利军
  <small>(微：qljcjjy)</small>
</h2>
<div style="margin-bottom: 20px;">
  <span>每行20个数字</span>
  <label for="rows" style="margin-left: 10px;">选择行数:</label>
  <input type="number" id="rows" min="1" max="20" value="1" class="rows-input">
</div>
<div id="timers">
  <div id="memoryTimer">记忆时间: 00:00</div>
  <div id="recallTimer">回忆时间: 00:00</div>
</div>
<div id="numberDisplay"></div>
<button id="generateNumbers">生成数字</button>
<button id="endMemory" style="display: none;">结束记忆</button>
<div id="inputArea"></div>
<button id="submitAnswers" style="display: none;">提交答案</button>
<div id="result"></div>
<div id="correctNumbers"></div>
<button id="restart" style="display: none;">再来一次</button>
<script>
let numbers = [];
let memoryStartTime, recallStartTime;
let memoryTimeSpent = 0;
let memoryTimerInterval, recallTimerInterval;
const numberDisplay = document.getElementById('numberDisplay');
const generateButton = document.getElementById('generateNumbers');
const endMemoryButton = document.getElementById('endMemory');
const submitAnswersButton = document.getElementById('submitAnswers');
const restartButton = document.getElementById('restart');
const inputArea = document.getElementById('inputArea');
const resultDiv = document.getElementById('result');
const rowsInput = document.getElementById('rows');
const memoryTimerDiv = document.getElementById('memoryTimer');
const recallTimerDiv = document.getElementById('recallTimer');
const correctNumbersDiv = document.getElementById('correctNumbers');

function updateTimer(timerType) {
  let currentTime, minutes, seconds;
  if (timerType === 'memory') {
    currentTime = new Date().getTime() - memoryStartTime;
    minutes = Math.floor(currentTime / 60000);
    seconds = ((currentTime % 60000) / 1000).toFixed(2);
    memoryTimerDiv.textContent = `记忆时间: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  } else if (timerType === 'recall') {
    currentTime = new Date().getTime() - recallStartTime;
    minutes = Math.floor(currentTime / 60000);
    seconds = ((currentTime % 60000) / 1000).toFixed(2);
    recallTimerDiv.textContent = `回忆时间: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
  }
}

function startMemoryTimer() {
  memoryStartTime = new Date().getTime();
  memoryTimerInterval = setInterval(() => updateTimer('memory'), 10);
}

function startRecallTimer() {
  recallStartTime = new Date().getTime();
  recallTimerInterval = setInterval(() => updateTimer('recall'), 10);
}

function generateNumbers() {
  numbers = [];
  numberDisplay.innerHTML = '';
  inputArea.innerHTML = '';
  correctNumbersDiv.innerHTML = '';
  const rows = parseInt(rowsInput.value, 10);
  for (let i = 0; i < rows; i++) {
    let rowDiv = document.createElement('div');
    rowDiv.classList.add('row'); // 添加类名用于样式控制
    for (let j = 0; j < 20; j++) { // 每行20个数字
      let number = Math.floor(Math.random() * 10);
      numbers.push(number);
      let numSpan = document.createElement('span');
      numSpan.textContent = number;
      rowDiv.appendChild(numSpan);
    }
    numberDisplay.appendChild(rowDiv);
  }
  generateButton.style.display = 'none';
  endMemoryButton.style.display = 'block';
  startMemoryTimer();
}

function endMemory() {
  clearInterval(memoryTimerInterval);
  memoryTimeSpent = new Date().getTime() - memoryStartTime;
  endMemoryButton.style.display = 'none';
  submitAnswersButton.style.display = 'block';
  recallTimerDiv.style.display = 'block';
  startRecallTimer();

  // 清除旧的数字显示
  numberDisplay.innerHTML = '';

  const inputRows = rowsInput.value; // 根据选择的行数计算输入格的行数
  let inputCount = inputRows * 20;
  let inputContainers = [];

  // 创建输入格并添加到DOM中
  for (let i = 0; i < inputCount; i++) {
    let inputContainer = document.createElement('div');
    inputContainer.classList.add('input-container');
    
    let input = document.createElement('input');
    input.type = 'text'; // 改为文本类型，以便支持键盘导航
    input.min = 0; // 最小值为0
    input.max = 9; // 最大值为9
    input.pattern = '\\d*'; // 只允许数字
    input.style.width = '30px'; // 保持宽度一致
    input.style.height = '30px';
    input.style.textAlign = 'center';
    input.id = `input${i}`; // 给每个输入框分配唯一ID
    
    // 添加点击事件处理程序，允许点击输入
    input.addEventListener('click', function() {
      this.focus();
      this.select();
    });
    
    // 监听输入框的变化
    input.addEventListener('input', function(event) {
      let value = event.target.value.replace(/[^0-9]/g, ''); // 移除非数字字符
      event.target.value = value;
      moveFocus(event.target);
    });

    // 监听键盘按键事件
    input.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' || event.key === 'Tab') {
        event.preventDefault(); // 阻止默认行为
        moveFocus(this);
      } else if (event.key === 'Backspace' || event.key === 'Delete') {
        event.preventDefault(); // 阻止默认行为
        this.value = '';
        moveBackFocus(this);
      }
    });

    inputArea.appendChild(inputContainer);
    inputContainer.appendChild(input);
    inputContainers.push(inputContainer);
  }

  // 自动聚焦到第一个输入框
  document.getElementById('input0').focus();

  // 添加删除功能
  function moveBackFocus(currentInput) {
    let currentIndex = parseInt(currentInput.id.replace('input', ''));
    let prevIndex = currentIndex - 1;
    if (prevIndex >= 0) {
      let prevInput = document.getElementById(`input${prevIndex}`);
      if (prevInput) {
        prevInput.focus();
        prevInput.select(); // 选中输入框中的内容
      }
    }
  }
}

function moveFocus(currentInput) {
  let currentIndex = parseInt(currentInput.id.replace('input', ''));
  let nextIndex = currentIndex + 1;
  if (nextIndex < 20 * rowsInput.value) {
    let nextInput = document.getElementById(`input${nextIndex}`);
    if (nextInput) {
      nextInput.focus();
      nextInput.select(); // 选中输入框中的内容
    }
  } else {
    // 如果是最后一个输入框，则不再跳转，而是提示用户提交答案
    submitAnswersButton.focus();
  }
}

function submitAnswers() {
  clearInterval(recallTimerInterval);
  let userNumbers = [];
  const inputs = document.querySelectorAll('#inputArea .input-container input');
  inputs.forEach(input => userNumbers.push(input.value === '' ? -1 : parseInt(input.value) || 0));
  let correct = 0, incorrect = 0;

  resultDiv.innerHTML = '';
  correctNumbersDiv.innerHTML = '';
  inputs.forEach((input, index) => {
    const correctNumberSpan = document.createElement('span');
    correctNumberSpan.textContent = numbers[index].toString();
    if (userNumbers[index] === -1 || numbers[index] !== userNumbers[index]) {
      incorrect++;
      input.parentElement.style.backgroundColor = 'red';
      correctNumberSpan.className = 'error';
    } else {
      correct++;
    }
    correctNumbersDiv.appendChild(correctNumberSpan);
    correctNumbersDiv.appendChild(document.createTextNode(' ')); // 使用一个半角空格

    // 每20个数字之后添加一个全角空格来区分不同的数字组
    if ((index + 1) % 20 === 0 && index < numbers.length - 1) {
      correctNumbersDiv.appendChild(document.createTextNode('　')); // 使用一个全角空格来区分
    }
  });

  const recallTime = (new Date().getTime() - recallStartTime) / 1000;
  resultDiv.textContent = `正确个数: ${correct}, 错误个数: ${incorrect}, 记忆时间: ${memoryTimeSpent / 1000}秒\n回忆时间: ${recallTime.toFixed(2)}秒`;

  // 在提交答案后隐藏 "提交答案" 按钮
  submitAnswersButton.style.display = 'none';

  restartButton.style.display = 'block';
}

function restart() {
  restartButton.style.display = 'none';
  generateButton.style.display = 'block';
  endMemoryButton.style.display = 'none';
  submitAnswersButton.style.display = 'none';
  numberDisplay.innerHTML = '';
  inputArea.innerHTML = '';
  resultDiv.innerHTML = '';
  correctNumbersDiv.innerHTML = '';
  memoryTimerDiv.textContent = '记忆时间: 00:00';
  recallTimerDiv.textContent = '回忆时间: 00:00';
  clearInterval(memoryTimerInterval);
  clearInterval(recallTimerInterval);
  memoryTimeSpent = 0;
}

// 添加按钮点击事件监听器
generateButton.addEventListener('click', generateNumbers);
endMemoryButton.addEventListener('click', endMemory);
submitAnswersButton.addEventListener('click', submitAnswers);
restartButton.addEventListener('click', restart);
</script>
</body>
</html>
